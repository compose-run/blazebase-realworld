{"version":3,"sources":["services/compose.ts","services/user.ts","services/article.ts","types/location.ts","types/genericFormField.tsx","components/ContainerPage.tsx","components/FormGroup.tsx","components/Errors.tsx","components/GenericForm.tsx","components/ArticleEditor.tsx","components/Pages/EditArticle.tsx","components/Footer.tsx","components/Header.tsx","types/style.ts","components/ArticlePreview.tsx","components/Pagination.tsx","components/ArticlesViewer.tsx","components/Pages/Home.tsx","components/Pages/Login.tsx","components/Pages/NewArticle.tsx","components/Pages/Register.tsx","components/Pages/Settings.tsx","components/UserInfo.tsx","components/Pages/ProfilePage.tsx","components/Pages/ArticlePage.tsx","components/App.tsx","index.tsx"],"names":["app","initializeApp","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","db","initializeFirestore","ignoreUndefinedProperties","firebaseAuth","getAuth","useReducerSafe","reducer","initialState","useReducer","val","dispatch","mountedRef","useRef","useEffect","current","useCallback","s","useFirebaseUser","acc","curr","firebaseUser","setFirebaseUser","onAuthStateChanged","user","emit","type","name","value","ts","id","a","addDoc","collection","serverTimestamp","Error","message","composeResolvers","emitWithResponse","Math","random","promise","Promise","resolve","undefined","cacheBehaviorLocalStorage","localStorage","setItem","JSON","stringify","getRealtimeState","initialBehaviorFromCacheQuery","query","orderBy","limit","getDocs","docs","doc","metadata","hasPendingWrites","data","saveReducer","reducerCode","initial","setDoc","getResolver","eventId","resolver","realtimeReducer","initialValue","loadingValue","context","event","p","cacheOrLoadingValue","cache","getItem","parse","getCachedBehaviorLocalStorage","kind","currentValue","emitToSelf","pendingEvents","concat","Object","prototype","toString","call","then","newContext","reduce","toMillis","realtimeReducers","useRealtimeReducer","realtimeContext","emitEvent","querySnapshot","eventEmitters","add","delete","size","unsubscribe","Set","newStreamEventsQuery","onSnapshot","forEach","emitter","usersVersion","useUsers","users","action","errors","some","u","email","username","uid","keys","length","map","newUser","useUser","find","useFollowers","userFollowers","follower","leader","followers","filter","uf","equals","useProfiles","following","articlesVersion","useArticlesDB","articles","slug","title","article","description","body","createdAt","updatedAt","updateArticleTags","tagList","useArticleTags","articleTagsOption","pt","tag","payload","useArticleFavorites","articleFavorites","f","useArticles","articlesDB","articleTags","authors","articleDB","articleTag","Date","favorited","favoritesCount","uniq","author","useArticleCommentsDB","comments","unauthorized","commentId","comment","c","redirect","path","location","hash","buildGenericFormField","placeholder","fieldType","lg","ContainerPage","children","className","FormGroup","disabled","onChange","TextAreaFormGroup","rows","ListFormGroup","listValue","onEnter","onRemoveItem","onKeyDown","ev","key","preventDefault","onKeyUp","onListFieldKeyUp","index","onClick","Errors","entries","field","fieldError","GenericForm","fields","formObject","submitButtonText","onSubmit","onAddItemToList","onRemoveListItem","onUpdateField","listName","target","ArticleEditor","submitting","useState","currentArticle","setCurrentArticle","tagTextbox","setTagTextbox","_","i","EditArticle","useParams","emitArticlesAction","setSubmitting","setErrors","newArticle","now","Footer","to","href","Header","NavItem","text","UserLinks","GuestLinks","icon","exact","activeClassName","classObjectToClassName","obj","join","ArticlePreview","image","isSubmitting","emitFavoriteAction","src","format","TagList","Pagination","currentPage","count","itemsPerPage","onPageChange","ceil","range","ArticlesViewer","toggleClassName","tabs","selectedTab","onTabChange","setCurrentPage","feedArticles","includes","sort","b","getTime","pageArticles","slice","articlesCount","ArticlesTabSet","ArticleList","tab","Tab","active","Home","setSelectedTab","buildTabsNames","HomeSidebar","Array","from","tags","useTags","Login","loggingIn","setLoggingIn","setEmail","password","setPassword","signInWithEmailAndPassword","login","NewArticle","emitArticleAction","generateSlug","slugify","remove","pow","Register","signingUp","setSigningUp","setUser","emitUserAction","createUserWithEmailAndPassword","bio","register","Settings","oldUser","updating","setUpdating","updateEmail","signOut","UserInfo","onFollowToggle","onEditSettings","sessionUsername","EditProfileButton","ToggleFollowButton","ProfilePage","emitFollowAction","submittingFollow","setSubmittingFollow","favorites","useLocation","pathname","endsWith","profiles","profile","page","ArticlePage","ArticlePageBanner","ArticleMeta","CommentSection","props","ArticleAuthorInfo","OwnerArticleMetaActions","NonOwnerArticleMetaActions","submittingFavorite","setSubmittingFavorite","btn","deleting","setDeleting","useArticleComments","CommentForm","style","display","ArticleComment","setBody","submittingComment","emitCommentAction","e","App","userIsLogged","GuestOnlyRoute","UserOnlyRoute","rest","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.f6ce5f20.chunk.js","sourcesContent":["// import { equals } from 'ramda';\nimport { useReducer, useEffect, useCallback, useRef, Reducer, Dispatch, ReducerAction, ReducerState } from 'react';\nimport { initializeApp } from 'firebase/app';\nimport {\n  initializeFirestore,\n  collection,\n  addDoc,\n  serverTimestamp,\n  query,\n  onSnapshot,\n  orderBy,\n  limit,\n  doc,\n  // getDoc,\n  getDocs,\n  setDoc,\n  Timestamp,\n  Unsubscribe,\n} from 'firebase/firestore';\nimport { getAuth, onAuthStateChanged, User as FirebaseUser } from 'firebase/auth';\n\n// TODO - will need to find a way for users to supply their own firebase credentials\nconst firebaseConfig = {\n  apiKey: 'AIzaSyDZtMhc933h53_fbJFmyM76Mh6aRreHZE8',\n  authDomain: 'compose-run.firebaseapp.com',\n  projectId: 'compose-run',\n  storageBucket: 'compose-run.appspot.com',\n  messagingSenderId: '685832812042',\n  appId: '1:685832812042:web:9c1ff1eca82128832791f3',\n  measurementId: 'G-ZX4ZC2215P',\n};\n\n// Initialize Firebase\nconst app = initializeApp(firebaseConfig);\nconst db = initializeFirestore(app, {\n  ignoreUndefinedProperties: true,\n});\nexport const firebaseAuth = getAuth(app);\n\n// There are sometimes race conditions around cleaning up\n// a memory leak and when React detects and complains about it\n// This is a wrapper around useReducer that ensures React's\n// memory leak detector won't complain\nexport const useReducerSafe = <A, B, R extends Reducer<A, B>>(\n  reducer: R,\n  initialState: ReducerState<R>\n): [ReducerState<R>, Dispatch<ReducerAction<R>>] => {\n  const [val, dispatch] = useReducer(reducer, initialState);\n  const mountedRef = useRef<boolean>();\n  useEffect(() => {\n    mountedRef.current = true;\n    return () => {\n      mountedRef.current = false;\n    };\n  }, []);\n  const safeDispatch = useCallback(\n    (s) => {\n      if (mountedRef.current) {\n        dispatch(s);\n      }\n    },\n    [dispatch]\n  );\n  return [val, safeDispatch];\n};\n\nfunction isPromise<A>(p: Promise<A> | A): boolean {\n  return p && Object.prototype.toString.call(p) === '[object Promise]';\n}\n\ntype maybeFirebaseUser = FirebaseUser | null;\n\n// This seems like a more React-safe way to access\n// the currently-logged-in Firebase user.\n// The other way `getAuth(app).currentUser` doesn't work with React all of the time\nexport const useFirebaseUser = (): maybeFirebaseUser => {\n  const [firebaseUser, setFirebaseUser] = useReducerSafe<\n    maybeFirebaseUser,\n    maybeFirebaseUser,\n    Reducer<maybeFirebaseUser, maybeFirebaseUser>\n  >((acc, curr) => curr, null);\n  useEffect(() => onAuthStateChanged(firebaseAuth, (user) => setFirebaseUser(user)), []);\n  return firebaseUser;\n};\n\n// This is a generic help to emit both stream events\n// as well as cached behavior values\nexport const emit = async <A>(\n  type: string,\n  name: string,\n  value: A,\n  ts?: Timestamp, // timestamp from an event if we have one\n  id?: number // how we tie together an emitted event and the reducer's response\n) => {\n  try {\n    await addDoc(collection(db, type, name, 'values'), {\n      value,\n      ts: ts || serverTimestamp(),\n      id,\n    });\n  } catch (e) {\n    throw new Error('Error emitting event: ' + e.message);\n  }\n};\n\n// This allows us to tie together an emitted event and the reducer's \"response\".\n// `composeResolvers` is a map from an eventId to that event's Promise's resovle function.\n// When the reducer resolver that event, it passes that resolve function as the last argument.\n// Calling `await resolve(errors)` for example,\n// allows the event emitter to `await` errors from the \"server\".\nconst composeResolvers = {};\nexport function emitWithResponse<B, C>(name: string, value: B): Promise<C> {\n  const id = Math.random();\n  const promise = new Promise<C>((resolve) => (composeResolvers[id] = resolve));\n  emit('streams', name, value, undefined, id);\n  return promise;\n}\n\n// cache all behaviors in localstorage for optimisic loading\nfunction cacheBehaviorLocalStorage<A>(name: string, value: A, ts: Timestamp) {\n  localStorage.setItem(\n    `compose-cache-${name}`,\n    JSON.stringify({\n      value,\n      ts,\n    })\n  );\n}\n\n// TODO - store the time retrieved from cached behavior so we can garbage collect\n// every X days or so? (make this a parameter?)\nfunction getCachedBehaviorLocalStorage(name: string) {\n  const cache = localStorage.getItem(`compose-cache-${name}`);\n  if (cache) {\n    return JSON.parse(cache).value; // maybe do something with ts eventually;\n  }\n}\n\nexport const getRealtimeState = async (name: string) => {\n  const initialBehaviorFromCacheQuery = query(\n    collection(db, 'behaviors', name, 'values'),\n    orderBy('ts', 'desc'),\n    limit(1)\n  );\n  const {\n    docs: [doc],\n  } = await getDocs(initialBehaviorFromCacheQuery);\n  if (doc && !doc.metadata.hasPendingWrites) {\n    return doc.data().value;\n  }\n};\n\n// save the reducer code to firebase so we can ensure all reducers\n// with the same name are identical\nfunction saveReducer<A>(name: string, reducerCode: string, initial: A) {\n  setDoc(doc(db, 'behaviors-reducers', name), {\n    reducerCode,\n    initial,\n  });\n}\n\ninterface RegisterEmitToSelf<a, b> {\n  emitToSelf: (event: RealtimeEvent<a, b>) => void;\n  kind: 'RegisterEmitToSelf';\n}\n\ninterface MismatchedReducerEvent {\n  kind: 'MismatchedReducerEvent';\n}\n\ninterface ReductionEvent<b> {\n  value: b;\n  ts: Timestamp;\n  kind: 'ReductionEvent';\n  id: number;\n}\n\ninterface CacheLoadedEvent<a> {\n  currentValue: a;\n  ts: Timestamp;\n  kind: 'CacheLoadedEvent';\n}\n\ninterface CacheEmptyEvent {\n  kind: 'CacheEmptyEvent';\n}\n\ninterface InitialValuePromiseLoadedEvent<a> {\n  currentValue: a;\n  kind: 'InitialValuePromiseLoadedEvent';\n}\n\ntype RealtimeEvent<a, b> =\n  | RegisterEmitToSelf<a, b>\n  | MismatchedReducerEvent\n  | CacheLoadedEvent<a>\n  | CacheEmptyEvent\n  | InitialValuePromiseLoadedEvent<a>\n  | ReductionEvent<b>;\n\ninterface LoadingEmitToSelf<a, b> {\n  currentValue: a;\n  pendingEvents: ReductionEvent<b>[];\n  kind: 'LoadingEmitToSelf';\n}\n\ninterface MismatchedReducer<a> {\n  currentValue: a;\n  kind: 'MismatchedReducer';\n}\n\ninterface LoadingFromCache<a, b> {\n  currentValue: a;\n  emitToSelf: (event: RealtimeEvent<a, b>) => void;\n  pendingEvents: ReductionEvent<b>[];\n  kind: 'LoadingFromCache';\n}\n\ninterface LoadingFromPromise<a, b> {\n  currentValue: a;\n  pendingEvents: ReductionEvent<b>[];\n  kind: 'LoadingFromPromise';\n}\n\ninterface SetFromInitialValue<a> {\n  currentValue: a;\n  kind: 'SetFromInitialValue';\n}\n\ninterface SetFromCacheOrReduction<a> {\n  currentValue: a;\n  ts: Timestamp;\n  kind: 'SetFromCacheOrReduction';\n}\n\ntype RealtimeReducerContext<a, b> =\n  | LoadingEmitToSelf<a, b>\n  | MismatchedReducer<a>\n  | LoadingFromCache<a, b>\n  | LoadingFromPromise<a, b>\n  | SetFromInitialValue<a>\n  | SetFromCacheOrReduction<a>;\n\n// retrieve the emitter's Promise's resolver function\n// and when called, delete it from the map\nfunction getResolver(eventId: number) {\n  const resolver = composeResolvers[eventId];\n  if (resolver) {\n    // eslint-disable-next-line\n    return (...args: any[]) => {\n      delete composeResolvers[eventId];\n      return resolver(...args);\n    };\n  } else {\n    return () => void 0;\n  }\n}\n\nfunction realtimeReducer<A, B, C>(\n  name: string,\n  reducer: (acc: A, curr: B, resolver?: (c: C) => void) => A,\n  initialValue: A | Promise<A>,\n  loadingValue: A,\n  context: RealtimeReducerContext<A, B>,\n  event: RealtimeEvent<A, B>\n): RealtimeReducerContext<A, B> {\n  const cacheOrLoadingValue = getCachedBehaviorLocalStorage(name) || loadingValue;\n  if (context.kind === 'MismatchedReducer') {\n    return context;\n  } else if (event.kind === 'MismatchedReducerEvent') {\n    return {\n      kind: 'MismatchedReducer',\n      currentValue: context.currentValue,\n    };\n  } else if (context.kind === 'LoadingEmitToSelf') {\n    if (event.kind === 'RegisterEmitToSelf') {\n      return {\n        emitToSelf: event.emitToSelf,\n        pendingEvents: context.pendingEvents,\n        currentValue: cacheOrLoadingValue,\n        kind: 'LoadingFromCache',\n      };\n    } else if (event.kind === 'ReductionEvent') {\n      return {\n        pendingEvents: context.pendingEvents.concat([event]),\n        currentValue: cacheOrLoadingValue,\n        kind: 'LoadingEmitToSelf',\n      };\n    } else {\n      return context;\n    }\n  } else if (event.kind === 'RegisterEmitToSelf') {\n    // no - op, because already registered\n    return context;\n  } else if (context.kind === 'LoadingFromCache') {\n    if (event.kind === 'CacheLoadedEvent') {\n      cacheBehaviorLocalStorage(name, event.currentValue, event.ts);\n      return {\n        currentValue: event.currentValue,\n        ts: event.ts,\n        kind: 'SetFromCacheOrReduction',\n      };\n    } else if (event.kind === 'CacheEmptyEvent') {\n      if (isPromise(initialValue)) {\n        (initialValue as Promise<A>).then((value) => {\n          context.emitToSelf({\n            currentValue: value,\n            kind: 'InitialValuePromiseLoadedEvent',\n          });\n        });\n        return {\n          currentValue: cacheOrLoadingValue,\n          pendingEvents: context.pendingEvents,\n          kind: 'LoadingFromPromise',\n        };\n      } else {\n        saveReducer(name, reducer.toString(), initialValue);\n        const newContext = context.pendingEvents.reduce(\n          (context: RealtimeReducerContext<A, B>, event) =>\n            realtimeReducer(name, reducer, initialValue, loadingValue, context, event),\n          {\n            currentValue: initialValue as A,\n            kind: 'SetFromInitialValue',\n          }\n        );\n        cacheBehaviorLocalStorage(name, newContext.currentValue, 'ts' in newContext && newContext.ts);\n        emit('behaviors', name, newContext.currentValue, 'ts' in newContext && newContext.ts);\n        return newContext;\n      }\n    } else if (event.kind === 'ReductionEvent') {\n      return {\n        ...context,\n        pendingEvents: context.pendingEvents.concat([event]),\n      };\n    } else {\n      return context;\n    }\n  } else if (context.kind === 'LoadingFromPromise') {\n    if (event.kind === 'InitialValuePromiseLoadedEvent') {\n      saveReducer(name, reducer.toString(), event.currentValue);\n      const newContext = context.pendingEvents.reduce(\n        (context: RealtimeReducerContext<A, B>, event) =>\n          realtimeReducer(name, reducer, initialValue, loadingValue, context, event),\n        {\n          currentValue: event.currentValue,\n          kind: 'SetFromInitialValue',\n        }\n      );\n      cacheBehaviorLocalStorage(name, newContext.currentValue, 'ts' in newContext && newContext.ts);\n      emit('behaviors', name, newContext.currentValue, 'ts' in newContext && newContext.ts);\n      return newContext;\n    } else if (event.kind === 'ReductionEvent') {\n      return {\n        currentValue: cacheOrLoadingValue,\n        pendingEvents: context.pendingEvents.concat([event]),\n        kind: 'LoadingFromPromise',\n      };\n    } else {\n      return context;\n    }\n  } else if (context.kind === 'SetFromInitialValue') {\n    if (event.kind === 'ReductionEvent') {\n      const currentValue = reducer(context.currentValue, event.value, getResolver(event.id));\n      getResolver(event.id)(); // delete & resolve if not done in reducer\n      cacheBehaviorLocalStorage(name, currentValue, event.ts);\n      emit('behaviors', name, currentValue, event.ts);\n      return {\n        currentValue,\n        ts: event.ts,\n        kind: 'SetFromCacheOrReduction',\n      };\n    } else {\n      return context;\n    }\n  } else if (context.kind === 'SetFromCacheOrReduction') {\n    if (event.kind === 'ReductionEvent') {\n      if (event.ts.toMillis() > context.ts.toMillis()) {\n        const currentValue = reducer(context.currentValue, event.value, getResolver(event.id));\n        getResolver(event.id)(); // delete & resolve if not done in reducer\n        cacheBehaviorLocalStorage(name, currentValue, event.ts);\n        emit('behaviors', name, currentValue, event.ts);\n        return {\n          currentValue,\n          ts: event.ts,\n          kind: 'SetFromCacheOrReduction',\n        };\n      } else {\n        return context;\n      }\n    } else {\n      return context;\n    }\n  } else {\n    return context;\n  }\n}\n\nconst realtimeReducers: {\n  [name: string]: {\n    context: RealtimeReducerContext<unknown, unknown>;\n    eventEmitters: Set<Dispatch<RealtimeEvent<unknown, unknown>>>;\n    unsubscribe?: Unsubscribe;\n  };\n} = {};\n\nexport function useRealtimeReducer<State, Action, Message>({\n  name,\n  initialValue,\n  reducer,\n  loadingValue,\n}: {\n  name: string;\n  initialValue: State | Promise<State>;\n  reducer: (state: State, action: Action, resolve?: (message: Message) => void) => State;\n  loadingValue: State;\n}): [State, (b: Action) => Promise<Message>] {\n  const [realtimeContext, emitEvent] = useReducerSafe(\n    (context: RealtimeReducerContext<State, Action>, event: RealtimeEvent<State, Action>) =>\n      realtimeReducer(name, reducer, initialValue, loadingValue, context, event),\n    {\n      currentValue: loadingValue,\n      pendingEvents: [],\n      kind: 'LoadingEmitToSelf',\n    }\n  );\n  useEffect(\n    () =>\n      emitEvent({\n        emitToSelf: emitEvent,\n        kind: 'RegisterEmitToSelf',\n      }),\n    []\n  );\n\n  // get initial behavior from firebase cache\n  useEffect(() => {\n    if (realtimeReducers[name] && realtimeReducers[name].context.kind === 'SetFromCacheOrReduction') {\n      emitEvent({\n        kind: 'CacheLoadedEvent',\n        currentValue: realtimeReducers[name].context.currentValue as State,\n        ts: (realtimeReducers[name].context as SetFromCacheOrReduction<unknown>).ts,\n      });\n    } else {\n      const initialBehaviorFromCacheQuery = query(\n        collection(db, 'behaviors', name, 'values'),\n        orderBy('ts', 'desc'),\n        limit(1)\n      );\n      getDocs(initialBehaviorFromCacheQuery).then((querySnapshot) => {\n        const doc = querySnapshot.docs[0];\n        if (!doc) {\n          emitEvent({ kind: 'CacheEmptyEvent' });\n        } else if (!doc.metadata.hasPendingWrites) {\n          emitEvent({\n            kind: 'CacheLoadedEvent',\n            currentValue: doc.data().value,\n            ts: doc.data().ts,\n          });\n        }\n      });\n    }\n  }, [name, emitEvent]);\n\n  // subscribe to all new stream events to reduce upon\n  useEffect(() => {\n    if (realtimeReducers[name]) {\n      realtimeReducers[name].eventEmitters.add(emitEvent);\n      return () => {\n        realtimeReducers[name].eventEmitters.delete(emitEvent);\n        if (realtimeReducers[name].eventEmitters.size === 0) {\n          realtimeReducers[name].unsubscribe();\n          delete realtimeReducers[name];\n        }\n      };\n    } else {\n      realtimeReducers[name] = { context: realtimeContext, eventEmitters: new Set([emitEvent]) };\n\n      const newStreamEventsQuery = query(collection(db, 'streams', name, 'values'), orderBy('ts', 'desc'), limit(1));\n      // It seems like this line might not be unsubscribing properly for React\n      // sometimes it causes a memory leak warning, but it may be a race condition\n      const unsubscribe = onSnapshot(newStreamEventsQuery, (querySnapshot) => {\n        const doc = querySnapshot.docs[0];\n        if (doc && !doc.metadata.hasPendingWrites) {\n          realtimeReducers[name].eventEmitters.forEach((emitter) =>\n            emitter({\n              kind: 'ReductionEvent',\n              value: doc.data().value,\n              ts: doc.data().ts,\n              id: doc.data().id,\n            })\n          );\n        }\n      });\n\n      realtimeReducers[name].unsubscribe = unsubscribe;\n      return () => 1; // don't unsubscribe here\n    }\n  }, [name, emitEvent]);\n\n  return [realtimeContext.currentValue, (value) => emitWithResponse(name, value)];\n}\n","import { equals } from 'ramda';\nimport { getRealtimeState, useFirebaseUser, useRealtimeReducer } from '../services/compose';\nimport { GenericErrors } from '../types/error';\nimport { Profile } from '../types/profile';\nimport { User, UId } from '../types/user';\n\ninterface SignUpUserAction {\n  type: 'SIGN_UP';\n  user: User;\n}\ninterface UpdateUserAction {\n  type: 'UPDATE';\n  newUser: User;\n  uid: UId;\n}\n\ntype UserAction = SignUpUserAction | UpdateUserAction;\n\ntype UserDB = User[];\n\nconst usersVersion = 111;\nexport const useUsers = () =>\n  useRealtimeReducer<UserDB, UserAction, GenericErrors>({\n    name: `conduit-users-${usersVersion}`,\n    initialValue: getRealtimeState(`conduit-users-${usersVersion - 1}`),\n    loadingValue: null,\n    reducer: (users, action, resolve) => {\n      const errors = {};\n      if (action.type === 'SIGN_UP') {\n        if (users.some((u) => u.email === action.user.email)) {\n          errors['email'] = 'already in use';\n        }\n        if (users.some((u) => u.username === action.user.username)) {\n          errors['username'] = 'already in use';\n        }\n        if (users.some((u) => u.uid === action.user.uid)) {\n          errors['public-key'] = 'already in use';\n        }\n        if (!Object.keys(errors).length) {\n          users = users.concat([action.user]);\n        }\n      } else if (action.type === 'UPDATE') {\n        if (action.uid) {\n          users = users.map((u) => (u.uid === action.uid ? action.newUser : u));\n        } else {\n          errors['unauthorized'] = 'to perform update to user';\n        }\n      }\n      resolve(errors);\n      return users;\n    },\n  });\n\nexport const useUser = () => {\n  const firebaseUser = useFirebaseUser();\n  const [users] = useUsers();\n\n  return firebaseUser && users && users.find((user) => user.uid === firebaseUser.uid);\n};\ninterface FollowUserAction {\n  type: 'FollowAction' | 'UnfollowAction';\n  uid: UId;\n  follower: UId;\n  leader: UId;\n}\n\ntype Follower = { leader: UId; follower: UId };\n\ntype FollowersDB = Follower[];\n\nexport const useFollowers = () =>\n  useRealtimeReducer<FollowersDB | null, FollowUserAction, GenericErrors>({\n    name: `conduit-followers-${usersVersion}`,\n    initialValue: getRealtimeState(`conduit-followers-${usersVersion - 1}`).then((s) => s || []),\n    loadingValue: null,\n    reducer: (userFollowers, action, resolve) => {\n      const { follower, leader } = action;\n\n      if (action.uid !== follower) {\n        resolve({ errors: ['unauthorized to perform this action'] });\n        return userFollowers;\n      }\n\n      const followers = userFollowers.filter((uf) => !equals(uf, { follower, leader }));\n\n      if (action.type === 'FollowAction') {\n        return [...followers, { follower, leader }];\n      } else {\n        followers;\n      }\n    },\n  });\n\nexport const useProfiles = (): Profile[] => {\n  const user = useUser();\n  const [users] = useUsers();\n  const [followers] = useFollowers();\n\n  return (\n    users &&\n    users.map((u) => ({\n      ...u,\n      following:\n        user && followers && followers.some(({ follower, leader }) => follower === user.uid && leader === u.uid),\n    }))\n  );\n};\n","import { useProfiles, useUser, useUsers } from './user';\nimport { emitWithResponse, getRealtimeState, useRealtimeReducer } from '../services/compose';\nimport { GenericErrors } from '../types/error';\nimport { Article, ArticleForEditor } from '../types/article';\nimport { User, UId } from '../types/user';\nimport { uniq } from 'ramda';\n\ntype Slug = string;\ninterface CreateArticleAction {\n  type: 'CreateArticleAction';\n  article: ArticleForEditor;\n  uid: UId;\n  slug: Slug;\n  createdAt: number;\n}\n\ninterface UpdateArticleAction {\n  type: 'UpdateArticleAction';\n  article: ArticleForEditor;\n  slug: Slug;\n  uid: UId;\n  updatedAt: number;\n}\n\ninterface DeleteArticleAction {\n  type: 'DeleteArticleAction';\n  slug: Slug;\n  uid: UId;\n}\n\ntype ArticleAction = CreateArticleAction | UpdateArticleAction | DeleteArticleAction;\n\nexport interface ArticleDB {\n  slug: Slug;\n  title: string;\n  description: string;\n  body: string;\n  createdAt: number;\n  updatedAt: number;\n  uid: UId;\n}\n\ninterface ArticleResolve {\n  slug?: string;\n  errors?: GenericErrors;\n}\n\nconst articlesVersion = 116;\nexport const useArticlesDB = () =>\n  useRealtimeReducer<ArticleDB[], ArticleAction, ArticleResolve>({\n    name: `conduit-articles-${articlesVersion}`,\n    initialValue: getRealtimeState(`conduit-articles-${articlesVersion - 1}`).then((s) => s || []),\n    loadingValue: null,\n    reducer: (articles, action, resolve) => {\n      const errors = {};\n      if (action.uid) {\n        if (action.type === 'CreateArticleAction') {\n          articles = articles.concat([\n            {\n              slug: action.slug,\n              title: action.article.title,\n              description: action.article.description,\n              body: action.article.body,\n              createdAt: action.createdAt,\n              updatedAt: action.createdAt,\n              uid: action.uid,\n            },\n          ]);\n          updateArticleTags({ slug: action.slug, uid: action.uid, tagList: action.article.tagList });\n        } else if (action.type === 'UpdateArticleAction') {\n          const article = articles.find(({ slug, uid }) => slug === action.slug && uid == action.uid);\n          if (!article) {\n            errors['404'] = ['article not found to update'];\n          } else if (article.uid !== action.uid) {\n            errors['unauthorized'] = ['to edit article'];\n          } else {\n            articles = articles.map((article) =>\n              article.slug == action.slug && article.uid === action.uid\n                ? {\n                    ...article,\n                    title: action.article.title,\n                    description: action.article.description,\n                    body: action.article.body,\n                    updatedAt: action.updatedAt,\n                  }\n                : article\n            );\n            updateArticleTags({ slug: action.slug, uid: action.uid, tagList: action.article.tagList });\n          }\n        } else if (action.type === 'DeleteArticleAction') {\n          const article = articles.find(({ slug, uid }) => slug === action.slug && uid == action.uid);\n          if (!article) {\n            errors['404'] = ['article not found to update'];\n          } else if (article.uid !== action.uid) {\n            errors['unauthorized'] = ['to edit article'];\n          } else {\n            articles = articles.filter((article) => article.slug !== action.slug);\n          }\n        }\n      } else {\n        errors['unauthorized'] = ['to edit article'];\n      }\n      if (Object.keys(errors).length) {\n        resolve({ errors });\n      } else {\n        resolve({ slug: action.slug });\n      }\n\n      return articles;\n    },\n  });\ninterface ArticleTag {\n  slug: Slug;\n  tag: string;\n  uid: UId;\n}\n\ninterface UpdateArticleTags {\n  type: 'UpdateArticleTags';\n  slug: Slug;\n  tagList: string[];\n  uid: UId;\n}\n\ntype ArticleTagAction = UpdateArticleTags;\n\nexport const useArticleTags = () =>\n  useRealtimeReducer<ArticleTag[], ArticleTagAction, GenericErrors>({\n    name: `conduit-tags-${articlesVersion}`,\n    initialValue: getRealtimeState(`conduit-tags-${articlesVersion - 1}`).then((s) => s || []),\n    loadingValue: null,\n    reducer: (articleTagsOption, action, resolve) => {\n      const errors = {};\n      if (action.uid) {\n        if (action.type === 'UpdateArticleTags') {\n          // remove all tags for this article\n          articleTagsOption = articleTagsOption.filter((pt) => !(pt.uid == action.uid && pt.slug === action.slug));\n\n          // add in tags for this article\n          articleTagsOption = articleTagsOption.concat(\n            action.tagList.map((tag) => ({ tag, slug: action.slug, uid: action.uid }))\n          );\n        }\n      } else {\n        errors['unauthorized'] = 'to edit article';\n      }\n      resolve(errors);\n      return articleTagsOption;\n    },\n  });\n\nexport const useTags = () => {\n  const [articleTags] = useArticleTags();\n  return articleTags && uniq(articleTags.map(({ tag }) => tag));\n};\n\n// when an article is created, this creates all the tags for it\nfunction updateArticleTags(payload: { slug: Slug; tagList: string[]; uid: UId }) {\n  return emitWithResponse(`conduit-tags-${articlesVersion}`, { ...payload, type: 'UpdateArticleTags' });\n}\n\ninterface FavoriteAction {\n  type: 'FavoriteAction' | 'UnfavoriteAction';\n  slug: Slug;\n  uid: UId;\n}\n\ntype ArticleFavoriteDB = { slug: Slug; uid: UId }[];\n\nexport const useArticleFavorites = () =>\n  useRealtimeReducer<ArticleFavoriteDB | null, FavoriteAction, GenericErrors>({\n    name: `conduit-favorites-${articlesVersion}`,\n    initialValue: getRealtimeState(`conduit-favorites-${articlesVersion - 1}`).then((s) => s || []),\n    loadingValue: null,\n    reducer: (articleFavorites, action, resolve) => {\n      const { slug, uid } = action;\n      if (!uid) {\n        resolve({ errors: ['unauthorized to perform this action'] });\n        return articleFavorites;\n      }\n\n      articleFavorites = articleFavorites.filter((f) => !(f.uid == uid && f.slug == slug));\n\n      if (action.type === 'FavoriteAction') {\n        articleFavorites = [...articleFavorites, { uid, slug }];\n      }\n\n      return articleFavorites;\n    },\n  });\n\nexport const useArticles = (): Article[] => {\n  const user = useUser();\n  const [articlesDB] = useArticlesDB();\n  const [articleTags] = useArticleTags();\n  const [articleFavorites] = useArticleFavorites();\n  const authors = useProfiles();\n\n  const articles =\n    articlesDB &&\n    articleTags &&\n    authors &&\n    articleFavorites &&\n    articlesDB.map((articleDB) => ({\n      slug: articleDB.slug,\n      title: articleDB.title,\n      description: articleDB.description,\n      body: articleDB.body,\n      tagList: articleTags.filter((articleTag) => articleTag.slug === articleDB.slug).map(({ tag }) => tag),\n      createdAt: new Date(articleDB.createdAt),\n      updatedAt: new Date(articleDB.updatedAt),\n      favorited: user && articleFavorites.some(({ slug, uid }) => user.uid === uid && slug === articleDB.slug),\n      favoritesCount: uniq(articleFavorites.filter(({ slug }) => slug === articleDB.slug)).length,\n      author: authors.find((u) => u.uid === articleDB.uid),\n    }));\n\n  return articles;\n};\n\ninterface CreateCommentAction {\n  type: 'CreateComment';\n  uid: UId;\n  body: string;\n  slug: Slug;\n  commentId: number;\n  createdAt: number;\n}\n\ninterface DeleteCommentAction {\n  type: 'DeleteComment';\n  uid: UId;\n  slug: Slug;\n  commentId: number;\n}\n\ntype CommentAction = CreateCommentAction | DeleteCommentAction;\n\ninterface CommentNormalized {\n  uid: UId;\n  commentId: number;\n  body: string;\n  createdAt: number;\n  slug: Slug;\n}\n\ntype NormalizedCommentDB = CommentNormalized[];\n\ninterface CommentResolve {\n  errors?: { unauthorized?: string };\n}\n\nexport const useArticleCommentsDB = () =>\n  useRealtimeReducer<NormalizedCommentDB | null, CommentAction, CommentResolve>({\n    name: `conduit-comments-${articlesVersion}`,\n    initialValue: getRealtimeState(`conduit-comments-${articlesVersion - 1}`).then((s) => s || []),\n    loadingValue: null,\n    reducer: (comments, action, resolve) => {\n      if (!action.uid) {\n        resolve({ errors: { unauthorized: 'to perform this action' } });\n        return comments;\n      }\n\n      const { slug, uid, commentId } = action;\n\n      if (action.type === 'CreateComment') {\n        const { body, createdAt } = action;\n        return [...comments, { uid, commentId, body, createdAt, slug }];\n      } else if (action.type === 'DeleteComment') {\n        const comment = comments[slug].find((c) => c.commentId === commentId);\n        if (comment && comment.uid === action.uid) {\n          return comments.filter((c) => c.commentId !== commentId);\n        } else {\n          resolve({ errors: { unauthorized: 'to perform this action' } });\n          return comments;\n        }\n      } else {\n        return comments;\n      }\n    },\n  });\n\nexport interface Comment {\n  uid: UId;\n  body: string;\n  slug: Slug;\n  commentId: number;\n  createdAt: Date;\n  author: User;\n}\n\ntype CommentsDB = Comment[];\n\nexport const useArticleComments = (): CommentsDB => {\n  const [comments] = useArticleCommentsDB();\n  const [users] = useUsers();\n\n  return (\n    comments &&\n    users &&\n    comments.map((comment) => ({\n      ...comment,\n      createdAt: new Date(comment.createdAt),\n      author: users.find((u: User) => u.uid === comment.uid),\n    }))\n  );\n};\n","export function redirect(path: string) {\n  location.hash = `#/${path}`;\n}\n","export interface GenericFormField {\n  name: string;\n  type: string;\n  placeholder: string;\n  rows?: number;\n  fieldType: 'input' | 'textarea' | 'list';\n  listName?: string;\n  lg: boolean;\n}\n\nexport function buildGenericFormField(data: Partial<GenericFormField> & { name: string }): GenericFormField {\n  return {\n    type: 'text',\n    placeholder: '',\n    fieldType: 'input',\n    lg: true,\n    ...data,\n  };\n}\n","export function ContainerPage({ children }: { children: JSX.Element | JSX.Element[] }) {\n  return (\n    <div className='container page'>\n      <div className='row'> {children} </div>\n    </div>\n  );\n}\n","import React from 'react';\n\nexport function FormGroup({\n  type,\n  placeholder,\n  disabled,\n  value,\n  onChange,\n  lg,\n}: {\n  type: string;\n  placeholder: string;\n  disabled: boolean;\n  value: string;\n  lg: boolean;\n  onChange: (ev: React.ChangeEvent<HTMLInputElement>) => void;\n}) {\n  return (\n    <fieldset className='form-group'>\n      <input\n        className={`form-control${!lg ? '' : ' form-control-lg'}`}\n        {...{ type, placeholder, disabled, value, onChange }}\n      />\n    </fieldset>\n  );\n}\n\nexport function TextAreaFormGroup({\n  type,\n  placeholder,\n  disabled,\n  value,\n  rows,\n  onChange,\n  lg,\n}: {\n  type: string;\n  placeholder: string;\n  disabled: boolean;\n  rows: number;\n  value: string;\n  lg: boolean;\n  onChange: (ev: React.ChangeEvent<HTMLTextAreaElement>) => void;\n}) {\n  return (\n    <fieldset className='form-group'>\n      <textarea\n        className={`form-control${!lg ? '' : ' form-control-lg'}`}\n        {...{ type, placeholder, disabled, value, onChange, rows }}\n      ></textarea>\n    </fieldset>\n  );\n}\n\nexport function ListFormGroup({\n  type,\n  placeholder,\n  disabled,\n  value,\n  listValue,\n  lg,\n  onChange,\n  onEnter,\n  onRemoveItem,\n}: {\n  type: string;\n  placeholder: string;\n  disabled: boolean;\n  value: string;\n  listValue: string[];\n  lg: boolean;\n  onChange: (ev: React.ChangeEvent<HTMLInputElement>) => void;\n  onEnter: () => void;\n  onRemoveItem: (index: number) => void;\n}) {\n  return (\n    <fieldset className='form-group'>\n      <input\n        className={`form-control${!lg ? '' : ' form-control-lg'}`}\n        {...{ type, placeholder, disabled, value, onChange }}\n        onKeyDown={(ev) => ev.key === 'Enter' && ev.preventDefault()}\n        onKeyUp={onListFieldKeyUp(onEnter)}\n      />\n      <div className='tag-list'>\n        {listValue &&\n          listValue.map((value, index) => (\n            <span key={value} className='tag-default tag-pill' onClick={() => onRemoveItem(index)}>\n              <i className='ion-close-round'></i>\n              {value}\n            </span>\n          ))}\n      </div>\n    </fieldset>\n  );\n}\n\nexport function onListFieldKeyUp(onEnter: () => void): (ev: React.KeyboardEvent) => void {\n  return (ev) => {\n    if (ev.key === 'Enter') {\n      ev.preventDefault();\n      onEnter();\n    }\n  };\n}\n","import { GenericErrors } from '../types/error';\n\nexport function Errors({ errors }: { errors: GenericErrors }) {\n  return (\n    <ul className='error-messages'>\n      {Object.entries(errors).map(([field, fieldErrors]) =>\n        fieldErrors.map((fieldError) => (\n          <li key={field + fieldError}>\n            {field} {fieldError}\n          </li>\n        ))\n      )}\n    </ul>\n  );\n}\n","import { FC, Fragment } from 'react';\nimport { FormGroup, ListFormGroup, TextAreaFormGroup } from './FormGroup';\nimport { GenericFormField } from '../types/genericFormField';\nimport { GenericErrors } from '../types/error';\nimport { Errors } from './Errors';\n\nexport interface GenericFormProps {\n  fields: GenericFormField[];\n  disabled: boolean;\n  formObject: Record<string, string | null>;\n  submitButtonText: string;\n  errors: GenericErrors;\n  onChange: (name: string, value: string) => void;\n  onSubmit: (ev: React.FormEvent) => void;\n  onAddItemToList?: (name: string) => void;\n  onRemoveListItem?: (name: string, index: number) => void;\n}\n\nexport const GenericForm: FC<GenericFormProps> = ({\n  fields,\n  disabled,\n  formObject,\n  submitButtonText,\n  errors,\n  onChange,\n  onSubmit,\n  onAddItemToList,\n  onRemoveListItem,\n}) => (\n  <Fragment>\n    <Errors errors={errors} />\n\n    <form onSubmit={onSubmit}>\n      <fieldset>\n        {fields.map((field) =>\n          field.fieldType === 'input' ? (\n            <FormGroup\n              key={field.name}\n              disabled={disabled}\n              type={field.type}\n              placeholder={field.placeholder}\n              value={formObject[field.name] || ''}\n              onChange={onUpdateField(field.name, onChange)}\n              lg={field.lg}\n            />\n          ) : field.fieldType === 'textarea' ? (\n            <TextAreaFormGroup\n              key={field.name}\n              disabled={disabled}\n              type={field.type}\n              placeholder={field.placeholder}\n              value={formObject[field.name] || ''}\n              rows={field.rows as number}\n              onChange={onUpdateField(field.name, onChange)}\n              lg={field.lg}\n            />\n          ) : (\n            <ListFormGroup\n              key={field.name}\n              disabled={disabled}\n              type={field.type}\n              placeholder={field.placeholder}\n              value={formObject[field.name] || ''}\n              onChange={onUpdateField(field.name, onChange)}\n              listValue={formObject[field.listName as string] as unknown as string[]}\n              onEnter={() => onAddItemToList && field.listName && onAddItemToList(field.listName)}\n              onRemoveItem={(index) => onRemoveListItem && field.listName && onRemoveListItem(field.listName, index)}\n              lg={field.lg}\n            />\n          )\n        )}\n        <button className='btn btn-lg btn-primary pull-xs-right'>{submitButtonText}</button>\n      </fieldset>\n    </form>\n  </Fragment>\n);\n\nfunction onUpdateField(\n  name: string,\n  onChange: GenericFormProps['onChange']\n): (ev: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => void {\n  return ({ target: { value } }) => {\n    onChange(name, value);\n  };\n}\n","import { uniq } from 'ramda';\nimport { useState } from 'react';\nimport { ArticleForEditor } from '../types/article';\nimport { GenericErrors } from './../types/error';\nimport { buildGenericFormField } from './../types/genericFormField';\nimport { ContainerPage } from './ContainerPage';\nimport { GenericForm } from './GenericForm';\n\nexport function ArticleEditor({\n  onSubmit,\n  submitting,\n  article,\n  errors,\n}: {\n  onSubmit: (newArticle: ArticleForEditor) => void;\n  submitting: boolean;\n  article?: ArticleForEditor;\n  errors: GenericErrors;\n}) {\n  const [currentArticle, setCurrentArticle] = useState(\n    article || { title: '', body: '', description: '', tagList: [] }\n  );\n  const [tagTextbox, setTagTextbox] = useState('');\n\n  function onUpdateField(name: string, value: string) {\n    if (name === 'tag') {\n      setTagTextbox(value);\n    } else if (name !== 'tagList') {\n      setCurrentArticle({\n        ...currentArticle,\n        [name]: value,\n      });\n    }\n  }\n\n  function onAddTag() {\n    setCurrentArticle({\n      ...currentArticle,\n      tagList: uniq(currentArticle.tagList.concat([tagTextbox])),\n    });\n    setTagTextbox('');\n  }\n\n  function onRemoveTag(_: string, index: number) {\n    setCurrentArticle({\n      ...currentArticle,\n      tagList: currentArticle.tagList.filter((_, i) => i !== index),\n    });\n  }\n\n  return (\n    <div className='editor-page'>\n      <ContainerPage>\n        <div className='col-md-10 offset-md-1 col-xs-12'>\n          <GenericForm\n            formObject={{ ...currentArticle, tag: tagTextbox } as unknown as Record<string, string | null>}\n            disabled={submitting}\n            errors={errors}\n            onChange={onUpdateField}\n            onSubmit={(ev) => {\n              ev.preventDefault();\n              onSubmit(currentArticle);\n            }}\n            submitButtonText='Publish Article'\n            onAddItemToList={onAddTag}\n            onRemoveListItem={onRemoveTag}\n            fields={[\n              buildGenericFormField({ name: 'title', placeholder: 'Article Title' }),\n              buildGenericFormField({ name: 'description', placeholder: \"What's this article about?\", lg: false }),\n              buildGenericFormField({\n                name: 'body',\n                placeholder: 'Write your article (in markdown)',\n                fieldType: 'textarea',\n                rows: 8,\n                lg: false,\n              }),\n              buildGenericFormField({\n                name: 'tag',\n                placeholder: 'Enter Tags',\n                listName: 'tagList',\n                fieldType: 'list',\n                lg: false,\n              }),\n            ]}\n          />\n        </div>\n      </ContainerPage>\n    </div>\n  );\n}\n","import { Fragment, useState } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { useArticles, useArticlesDB } from '../../services/article';\nimport { useUser } from '../../services/user';\nimport { redirect } from '../../types/location';\nimport { ArticleEditor } from '../ArticleEditor';\n\nexport function EditArticle() {\n  const { slug } = useParams<{ slug: string }>();\n  const user = useUser();\n\n  const [, emitArticlesAction] = useArticlesDB();\n\n  const articles = useArticles();\n  const article = articles && articles.find((a) => a.slug === slug);\n\n  const [submitting, setSubmitting] = useState(false);\n  const [errors, setErrors] = useState({});\n\n  if (article && user && article.author.uid !== user.uid) {\n    redirect('');\n    return;\n  }\n\n  async function onSubmit(newArticle) {\n    setSubmitting(true);\n\n    if (!user) {\n      redirect('');\n    }\n\n    const { errors } = await emitArticlesAction({\n      type: 'UpdateArticleAction',\n      article: newArticle,\n      slug,\n      uid: user.uid,\n      updatedAt: Date.now(),\n    });\n\n    setSubmitting(false);\n\n    if (errors) {\n      setErrors(errors);\n    } else {\n      redirect(`article/${slug}`);\n    }\n  }\n\n  return (\n    <Fragment>\n      {article && <ArticleEditor onSubmit={onSubmit} submitting={submitting} article={article} errors={errors} />}\n    </Fragment>\n  );\n}\n","import { Link } from 'react-router-dom';\n\nexport function Footer() {\n  return (\n    <footer>\n      <div className='container'>\n        <Link to='' className='logo-font'>\n          conduit\n        </Link>\n        <span className='attribution'>\n          An interactive learning project from <a href='https://thinkster.io'>Thinkster</a>. Code &amp; design licensed\n          under MIT.\n        </span>\n      </div>\n    </footer>\n  );\n}\n","import { Fragment } from 'react';\nimport { HashRouter, NavLink } from 'react-router-dom';\nimport { useUser } from '../services/user';\nimport { User } from '../types/user';\nimport { Link } from 'react-router-dom';\n\nexport function Header() {\n  const user = useUser();\n\n  return (\n    <nav className='navbar navbar-light'>\n      <div className='container'>\n        <Link className='navbar-brand' to=''>\n          conduit\n        </Link>\n        <ul className='nav navbar-nav pull-xs-right'>\n          <HashRouter>\n            <NavItem text='Home' href='' />\n\n            {user ? <UserLinks user={user} /> : <GuestLinks />}\n          </HashRouter>\n        </ul>\n      </div>\n    </nav>\n  );\n}\n\nfunction NavItem({ text, href, icon }: { text: string; href: string; icon?: string }) {\n  return (\n    <li className='nav-item'>\n      <NavLink exact to={href} activeClassName='active' className='nav-link'>\n        {icon && <i className={icon}></i>}&nbsp;\n        {text}\n      </NavLink>\n    </li>\n  );\n}\n\nfunction GuestLinks() {\n  return (\n    <Fragment>\n      <NavItem text='Sign in' href='/login' />\n      <NavItem text='Sign up' href='/register' />\n    </Fragment>\n  );\n}\n\nfunction UserLinks({ user: { username } }: { user: User }) {\n  return (\n    <Fragment>\n      <NavItem text='New Article' href='/editor' icon='ion-compose' />\n      <NavItem text='Settings' href='/settings' icon='ion-gear-a' />\n      <NavItem text={`${username}`} href={`/profile/${username}`} />\n    </Fragment>\n  );\n}\n","export function classObjectToClassName(obj: Record<string, boolean>): string {\n  return Object.entries(obj)\n    .filter(([, active]) => active)\n    .map(([name]) => name)\n    .join(' ');\n}\n","import { format } from 'date-fns';\nimport { useState } from 'react';\nimport { Link } from 'react-router-dom';\nimport { Article } from '../types/article';\nimport { useUser } from '../services/user';\nimport { useArticleFavorites } from '../services/article';\n\nexport function ArticlePreview({\n  article: {\n    createdAt,\n    favorited,\n    favoritesCount,\n    slug,\n    title,\n    description,\n    tagList,\n    author: { image = '', username = '' },\n  },\n}: {\n  article: Article;\n}) {\n  const user = useUser();\n  const [isSubmitting, setSubmitting] = useState(false);\n\n  const [, emitFavoriteAction] = useArticleFavorites();\n\n  async function onFavoriteToggle() {\n    if (!user) return;\n\n    setSubmitting(true);\n\n    await emitFavoriteAction({\n      type: favorited ? 'UnfavoriteAction' : 'FavoriteAction',\n      slug,\n      uid: user.uid,\n    });\n\n    setSubmitting(false);\n  }\n\n  return (\n    <div className='article-preview'>\n      <div className='article-meta'>\n        <Link to={`/profile/${username}`} className='author'>\n          <img src={image || undefined} />\n        </Link>\n        <div className='info'>\n          <Link to={`/profile/${username}`} className='author'>\n            {username}\n          </Link>\n          <span className='date'>{format(createdAt, 'PP')}</span>\n        </div>\n        <button\n          className={`btn btn-sm pull-xs-right ${favorited ? 'btn-primary' : 'btn-outline-primary'}`}\n          aria-label='Toggle Favorite'\n          disabled={isSubmitting}\n          onClick={onFavoriteToggle}\n        >\n          <i className='ion-heart'></i> {favoritesCount}\n        </button>\n      </div>\n      <Link to={`article/${slug}`} className='preview-link'>\n        <h1>{title}</h1>\n        <p>{description}</p>\n        <span>Read more...</span>\n        <TagList tagList={tagList} />\n      </Link>\n    </div>\n  );\n}\n\nexport function TagList({ tagList }: { tagList: string[] }) {\n  return (\n    <ul className='tag-list'>\n      {tagList.map((tag) => (\n        <li key={tag} className='tag-default tag-pill tag-outline'>\n          {tag}\n        </li>\n      ))}\n    </ul>\n  );\n}\n","import { range } from 'ramda';\n\nexport function Pagination({\n  currentPage,\n  count,\n  itemsPerPage,\n  onPageChange,\n}: {\n  currentPage: number;\n  count: number;\n  itemsPerPage: number;\n  onPageChange?: (index: number) => void;\n}) {\n  return (\n    <nav>\n      <ul className='pagination'>\n        {Math.ceil(count / itemsPerPage) > 1 &&\n          range(1, Math.ceil(count / itemsPerPage) + 1).map((index) => (\n            <li\n              key={index}\n              className={`page-item${currentPage !== index ? '' : ' active'}`}\n              onClick={onPageChange && (() => onPageChange(index))}\n            >\n              <a className='page-link' aria-label={`Go to page number ${index}`} href='#'>\n                {index}\n              </a>\n            </li>\n          ))}\n      </ul>\n    </nav>\n  );\n}\n","import { Fragment, useState } from 'react';\nimport { classObjectToClassName } from './../types/style';\nimport { useFollowers, useUser } from './../services/user';\nimport { ArticlePreview } from './ArticlePreview';\nimport { Pagination } from './Pagination';\nimport { useArticles } from '../services/article';\n\nexport function ArticlesViewer({\n  toggleClassName,\n  tabs,\n  selectedTab,\n  onTabChange,\n  uid,\n}: {\n  toggleClassName: string;\n  tabs: string[];\n  selectedTab: string;\n  onTabChange?: (tab: string) => void;\n  uid?: string;\n}) {\n  const [currentPage, setCurrentPage] = useState(1);\n  const user = useUser();\n  const articles = useArticles();\n  const [following] = useFollowers();\n\n  const feedArticles =\n    articles &&\n    articles\n      .filter(\n        (article) =>\n          selectedTab === 'Global Feed' ||\n          (selectedTab === 'Your Feed' && user && following[user.uid] && following[user.uid][article.author.uid]) ||\n          (selectedTab === 'My Articles' && article.author.uid === uid) ||\n          (selectedTab === 'Favorited Articles' && article.favorited) ||\n          article.tagList.includes(selectedTab)\n      )\n      .sort((a, b) => a.createdAt.getTime() - b.createdAt.getTime());\n\n  const pageArticles = feedArticles && feedArticles.slice((currentPage - 1) * 10, currentPage * 10);\n  const articlesCount = feedArticles ? feedArticles.length : 0;\n\n  return (\n    <Fragment>\n      <ArticlesTabSet {...{ tabs, selectedTab, toggleClassName, onTabChange }} />\n      <ArticleList articles={pageArticles} />\n      <Pagination currentPage={currentPage} count={articlesCount} itemsPerPage={10} onPageChange={setCurrentPage} />\n    </Fragment>\n  );\n}\n\nfunction ArticlesTabSet({\n  tabs,\n  toggleClassName,\n  selectedTab,\n  onTabChange,\n}: {\n  tabs: string[];\n  toggleClassName: string;\n  selectedTab: string;\n  onTabChange?: (tab: string) => void;\n}) {\n  return (\n    <div className={toggleClassName}>\n      <ul className='nav nav-pills outline-active'>\n        {tabs.map((tab) => (\n          <Tab key={tab} tab={tab} active={tab === selectedTab} onClick={() => onTabChange && onTabChange(tab)} />\n        ))}\n      </ul>\n    </div>\n  );\n}\n\nfunction Tab({ tab, active, onClick }: { tab: string; active: boolean; onClick: () => void }) {\n  return (\n    <li className='nav-item'>\n      <a\n        className={classObjectToClassName({ 'nav-link': true, active })}\n        href='#'\n        onClick={(ev) => {\n          ev.preventDefault();\n          onClick();\n        }}\n      >\n        {tab}\n      </a>\n    </li>\n  );\n}\n\nfunction ArticleList({ articles }) {\n  return articles ? (\n    <Fragment>\n      {articles.length === 0 && (\n        <div className='article-preview' key={1}>\n          No articles are here... yet.\n        </div>\n      )}\n      {articles.map((article) => (\n        <ArticlePreview key={article.slug} article={article} />\n      ))}\n    </Fragment>\n  ) : (\n    <div className='article-preview' key={1}>\n      Loading articles...\n    </div>\n  );\n}\n","import { useState } from 'react';\nimport { useTags } from '../../services/article';\nimport { useUser } from '../../services/user';\nimport { ArticlesViewer } from '../ArticlesViewer';\nimport { ContainerPage } from '../ContainerPage';\n\nexport function Home() {\n  const user = useUser();\n  const [selectedTab, setSelectedTab] = useState(user ? 'Your Feed' : 'Global Feed');\n\n  return (\n    <div className='home-page'>\n      {renderBanner()}\n      <ContainerPage>\n        <div className='col-md-9'>\n          <ArticlesViewer\n            toggleClassName='feed-toggle'\n            selectedTab={selectedTab}\n            tabs={buildTabsNames(selectedTab)}\n            onTabChange={setSelectedTab}\n          />\n        </div>\n\n        <div className='col-md-3'>\n          <HomeSidebar setSelectedTab={setSelectedTab} />\n        </div>\n      </ContainerPage>\n    </div>\n  );\n}\n\nfunction renderBanner() {\n  return (\n    <div className='banner'>\n      <div className='container'>\n        <h1 className='logo-font'>conduit</h1>\n        <p>A place to share your knowledge.</p>\n      </div>\n    </div>\n  );\n}\n\nfunction buildTabsNames(selectedTab: string) {\n  const user = useUser();\n  return Array.from(new Set([...(user ? ['Your Feed'] : []), selectedTab, 'Global Feed']));\n}\n\nfunction HomeSidebar({ setSelectedTab }) {\n  const tags = useTags();\n\n  return (\n    <div className='sidebar'>\n      <p>Popular Tags</p>\n\n      {tags ? (\n        <div className='tag-list'>\n          {' '}\n          {tags.map((tag) => (\n            <a key={tag} href='#' className='tag-pill tag-default' onClick={() => setSelectedTab(tag)}>\n              {tag}\n            </a>\n          ))}{' '}\n        </div>\n      ) : (\n        <span>Loading tags...</span>\n      )}\n    </div>\n  );\n}\n","import { signInWithEmailAndPassword } from 'firebase/auth';\nimport React, { useState } from 'react';\nimport { buildGenericFormField } from './../../types/genericFormField';\nimport { GenericForm } from './../GenericForm';\nimport { ContainerPage } from './../ContainerPage';\nimport { useUsers } from '../../services/user';\nimport { firebaseAuth } from '../../services/compose';\nimport { redirect } from '../../types/location';\nimport { Link } from 'react-router-dom';\n\nexport function Login() {\n  const [users] = useUsers();\n\n  const [loggingIn, setLoggingIn] = useState(false);\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [errors, setErrors] = useState({});\n\n  async function signIn(ev: React.FormEvent) {\n    ev.preventDefault();\n\n    setLoggingIn(true);\n\n    const user = users && users.find((u) => u.email === email);\n    if (!user) {\n      setErrors({ email: ['not found'] });\n      setLoggingIn(false);\n      return;\n    }\n\n    try {\n      await signInWithEmailAndPassword(firebaseAuth, user.email, password);\n      redirect('');\n    } catch (e) {\n      setErrors({ login: [e.message] });\n    }\n\n    setLoggingIn(false);\n  }\n\n  function onUpdateField(name: string, value: string) {\n    if (name === 'email') {\n      setEmail(value);\n    } else if (name === 'password') {\n      setPassword(value);\n    }\n  }\n\n  return (\n    <div className='auth-page'>\n      <ContainerPage>\n        <div className='col-md-6 offset-md-3 col-xs-12'>\n          <h1 className='text-xs-center'>Sign in</h1>\n          <p className='text-xs-center'>\n            <Link to='/#/register'>Need an account?</Link>\n          </p>\n\n          <GenericForm\n            disabled={loggingIn}\n            formObject={{ email, password }}\n            submitButtonText='Sign in'\n            errors={errors}\n            onChange={onUpdateField}\n            onSubmit={signIn}\n            fields={[\n              buildGenericFormField({ name: 'email', placeholder: 'Email' }),\n              buildGenericFormField({ name: 'password', placeholder: 'Password', type: 'password' }),\n            ]}\n          />\n        </div>\n      </ContainerPage>\n    </div>\n  );\n}\n","import { useState } from 'react';\nimport { ArticleForEditor } from './../../types/article';\nimport { useArticlesDB } from './../../services/article';\nimport { useUser } from './../../services/user';\nimport { ArticleEditor } from './../ArticleEditor';\nimport { redirect } from '../../types/location';\nimport slugify from 'slugify';\n\nexport function NewArticle() {\n  const user = useUser();\n  const [, emitArticleAction] = useArticlesDB();\n\n  const [submitting, setSubmitting] = useState(false);\n  const [errors, setErrors] = useState({});\n\n  async function onSubmit(newArticle: ArticleForEditor) {\n    setSubmitting(true);\n    try {\n      const { errors, slug } = await emitArticleAction({\n        type: 'CreateArticleAction',\n        article: newArticle,\n        createdAt: Date.now(),\n        uid: user.uid,\n        slug: generateSlug(newArticle.title),\n      });\n\n      setSubmitting(false);\n\n      if (errors) {\n        setErrors(errors);\n      } else {\n        redirect(`article/${slug}`);\n      }\n    } catch (e) {\n      setErrors({ 'unknown network error': e.message });\n    }\n  }\n\n  return <ArticleEditor onSubmit={onSubmit} errors={errors} submitting={submitting} />;\n}\n\nfunction generateSlug(title) {\n  return slugify(title, { remove: /[^\\w\\s-]/g }) + '-' + ((Math.random() * Math.pow(36, 6)) | 0).toString(36);\n}\n","import { createUserWithEmailAndPassword } from 'firebase/auth';\nimport { buildGenericFormField } from './../../types/genericFormField';\nimport { GenericForm } from './../GenericForm';\nimport { useUsers } from './../../services/user';\nimport { ContainerPage } from './../ContainerPage';\nimport { useState } from 'react';\nimport { firebaseAuth } from '../../services/compose';\nimport { redirect } from '../../types/location';\nimport { Link } from 'react-router-dom';\n\nexport function Register() {\n  const [errors, setErrors] = useState({});\n  const [signingUp, setSigningUp] = useState(false);\n  const [user, setUser] = useState({ username: '', email: '', password: '' });\n\n  const [, emitUserAction] = useUsers();\n\n  function onUpdateField(name: string, value: string) {\n    setUser({ ...user, [name]: value });\n  }\n\n  async function onSignUp(ev: React.FormEvent) {\n    ev.preventDefault();\n    setSigningUp(true);\n\n    try {\n      const {\n        user: { uid },\n      } = await createUserWithEmailAndPassword(firebaseAuth, user.email, user.password);\n      const errors = await emitUserAction({\n        type: 'SIGN_UP',\n        user: {\n          username: user.username,\n          email: user.email,\n          uid,\n          bio: null,\n          image: null,\n        },\n      });\n\n      if (Object.keys(errors).length) {\n        setErrors(errors);\n      } else {\n        redirect('');\n      }\n    } catch (e) {\n      setErrors({ register: [e.message] });\n    }\n\n    setSigningUp(false);\n  }\n\n  return (\n    <div className='auth-page'>\n      <ContainerPage>\n        <div className='col-md-6 offset-md-3 col-xs-12'>\n          <h1 className='text-xs-center'>Sign up</h1>\n          <p className='text-xs-center'>\n            <Link to='login'>Have an account?</Link>\n          </p>\n\n          <GenericForm\n            disabled={signingUp}\n            formObject={user as unknown as Record<string, string>}\n            submitButtonText='Sign up'\n            errors={errors}\n            onChange={onUpdateField}\n            onSubmit={onSignUp}\n            fields={[\n              buildGenericFormField({ name: 'username', placeholder: 'Username' }),\n              buildGenericFormField({ name: 'email', placeholder: 'Email' }),\n              buildGenericFormField({ name: 'password', placeholder: 'Password', type: 'password' }),\n            ]}\n          />\n        </div>\n      </ContainerPage>\n    </div>\n  );\n}\n","import React, { useState } from 'react';\nimport { useUser, useUsers } from './../../services/user';\nimport { buildGenericFormField } from './../../types/genericFormField';\nimport { GenericForm } from './../GenericForm';\nimport { ContainerPage } from './../ContainerPage';\nimport { UserSettings } from '../../types/user';\nimport { signOut, updateEmail } from 'firebase/auth';\nimport { firebaseAuth, useFirebaseUser } from '../../services/compose';\nimport { redirect } from '../../types/location';\n\nexport interface SettingsField {\n  name: keyof UserSettings;\n  type?: string;\n  isTextArea?: true;\n  placeholder: string;\n}\n\nexport function Settings() {\n  const oldUser = useUser();\n  const firebaseUser = useFirebaseUser();\n  const [newUser, setUser] = useState(null);\n  const [errors, setErrors] = useState({});\n  const [updating, setUpdating] = useState(false);\n\n  const user = newUser || (oldUser ? oldUser : {});\n\n  function onUpdateField(name: string, value: string) {\n    setUser({ ...user, [name]: value });\n  }\n\n  const [, emitUserAction] = useUsers();\n\n  async function onUpdateSettings(ev: React.FormEvent) {\n    ev.preventDefault();\n    if (!oldUser) {\n      return;\n    }\n\n    setUpdating(true);\n\n    if (oldUser.email !== newUser.email) {\n      updateEmail(firebaseUser, newUser.email);\n    }\n\n    const errors = await emitUserAction({\n      type: 'UPDATE',\n      uid: oldUser.uid,\n      newUser: user,\n    });\n    setUpdating(false);\n    if (Object.keys(errors).length) {\n      setErrors(errors);\n    } else {\n      redirect('');\n    }\n  }\n\n  return (\n    <div className='settings-page'>\n      <ContainerPage>\n        <div className='col-md-6 offset-md-3 col-xs-12'>\n          <h1 className='text-xs-center'>Your Settings</h1>\n\n          <GenericForm\n            disabled={updating}\n            formObject={{ ...user }}\n            submitButtonText='Update Settings'\n            errors={errors}\n            onChange={onUpdateField}\n            onSubmit={onUpdateSettings}\n            fields={[\n              buildGenericFormField({ name: 'image', placeholder: 'URL of profile picture' }),\n              buildGenericFormField({ name: 'username', placeholder: 'Your Name' }),\n              buildGenericFormField({\n                name: 'bio',\n                placeholder: 'Short bio about you',\n                rows: 8,\n                fieldType: 'textarea',\n              }),\n              buildGenericFormField({ name: 'email', placeholder: 'Email' }),\n              buildGenericFormField({ name: 'password', placeholder: 'Password', type: 'password' }),\n            ]}\n          />\n\n          <hr />\n          <button className='btn btn-outline-danger' onClick={() => signOut(firebaseAuth)}>\n            Or click here to logout.\n          </button>\n        </div>\n      </ContainerPage>\n    </div>\n  );\n}\n","import { Profile } from '../types/profile';\nimport { useUser } from '../services/user';\n\nexport function UserInfo({\n  user: { image, username, bio, following },\n  disabled,\n  onFollowToggle,\n  onEditSettings,\n}: {\n  user: Profile;\n  disabled: boolean;\n  onFollowToggle?: () => void;\n  onEditSettings?: () => void;\n}) {\n  const user = useUser();\n  const sessionUsername = user ? user.username : '';\n\n  return (\n    <div className='user-info'>\n      <div className='container'>\n        <div className='row'>\n          <div className='col-xs-12 col-md-10 offset-md-1'>\n            <img src={image || undefined} className='user-img' />\n            <h4>{username}</h4>\n            <p>{bio}</p>\n\n            {sessionUsername === username ? (\n              <EditProfileButton onClick={onEditSettings} disabled={disabled} />\n            ) : (\n              <ToggleFollowButton\n                following={following}\n                username={username}\n                disabled={disabled}\n                onClick={onFollowToggle}\n              />\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction ToggleFollowButton({\n  following,\n  username,\n  disabled,\n  onClick,\n}: {\n  following: boolean;\n  username: string;\n  disabled: boolean;\n  onClick?: () => void;\n}) {\n  return (\n    <button className='btn btn-sm btn-outline-secondary action-btn' onClick={onClick} disabled={disabled}>\n      <i className='ion-plus-round'></i>\n      &nbsp;\n      {following ? ' Unfollow' : ' Follow'} {username}\n    </button>\n  );\n}\n\nfunction EditProfileButton({ disabled, onClick }: { disabled: boolean; onClick?: () => void }) {\n  return (\n    <button className='btn btn-sm btn-outline-secondary action-btn' onClick={onClick} disabled={disabled}>\n      <i className='ion-gear-a'></i>&nbsp; Edit Profile Settings\n    </button>\n  );\n}\n","import { useState } from 'react';\nimport { useLocation, useParams } from 'react-router-dom';\nimport { redirect } from '../../types/location';\nimport { Profile } from '../../types/profile';\nimport { useFollowers, useProfiles, useUser } from '../../services/user';\nimport { ArticlesViewer } from '../ArticlesViewer';\nimport { UserInfo } from '../UserInfo';\n\nexport function ProfilePage() {\n  const user = useUser();\n  const [, emitFollowAction] = useFollowers();\n  const [submittingFollow, setSubmittingFollow] = useState(false);\n\n  const { username } = useParams<{ username: string }>();\n  const favorites = useLocation().pathname.endsWith('favorites');\n\n  const profiles = useProfiles();\n  const profile = profiles && profiles.find((u) => u.username === username);\n\n  async function onFollowToggle(profile: Profile) {\n    if (!user) {\n      redirect('register');\n      return;\n    }\n\n    setSubmittingFollow(true);\n\n    await emitFollowAction({\n      type: profile.following ? 'UnfollowAction' : 'FollowAction',\n      follower: user.uid,\n      leader: profile.uid,\n      uid: user.uid,\n    });\n\n    setSubmittingFollow(false);\n  }\n\n  return (\n    <div className='profile-page'>\n      {profile ? (\n        <UserInfo\n          user={profile}\n          disabled={submittingFollow}\n          onFollowToggle={() => onFollowToggle(profile)}\n          onEditSettings={() => redirect('settings')}\n        />\n      ) : (\n        <div className='article-preview' key={1}>\n          Loading profile...\n        </div>\n      )}\n      <div className='container'>\n        <div className='row'>\n          <div className='col-xs-12 col-md-10 offset-md-1'>\n            <ArticlesViewer\n              toggleClassName='articles-toggle'\n              tabs={['My Articles', 'Favorited Articles']}\n              selectedTab={favorites ? 'Favorited Articles' : 'My Articles'}\n              onTabChange={onTabChange(username)}\n              uid={profile && profile.uid}\n            />\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction onTabChange(username: string): (page: string) => void {\n  return async (page) => {\n    const favorited = page === 'Favorited Articles';\n    redirect(`profile/${username}${!favorited ? '' : 'favorites'}`);\n  };\n}\n","import { format } from 'date-fns';\nimport { Fragment, useState } from 'react';\nimport { Link, useParams } from 'react-router-dom';\nimport { Article } from './../../types/article';\nimport { redirect } from './../../types/location';\nimport { classObjectToClassName } from './../../types/style';\nimport { useFollowers, useUser } from './../../services/user';\nimport { User } from './../../types/user';\nimport { TagList } from './../ArticlePreview';\nimport {\n  useArticleComments,\n  useArticleCommentsDB,\n  useArticleFavorites,\n  useArticles,\n  useArticlesDB,\n  Comment,\n} from '../../services/article';\n\nexport function ArticlePage() {\n  const { slug } = useParams<{ slug: string }>();\n\n  const articles = useArticles();\n  const article = articles && articles.find((a) => a.slug === slug);\n\n  if (articles && !article) {\n    redirect('');\n  }\n\n  return article ? (\n    <div className='article-page'>\n      <ArticlePageBanner {...{ article }} />\n\n      <div className='container page'>\n        <div className='row article-content'>\n          <div className='col-md-12'>{article.body}</div>\n          <TagList tagList={article.tagList} />\n        </div>\n\n        <hr />\n\n        <div className='article-actions'>\n          <ArticleMeta {...{ article }} />\n        </div>\n\n        <CommentSection {...{ article }} />\n      </div>\n    </div>\n  ) : (\n    <div>Loading article...</div>\n  );\n}\n\nfunction ArticlePageBanner(props: { article: Article }) {\n  return (\n    <div className='banner'>\n      <div className='container'>\n        <h1>{props.article.title}</h1>\n\n        <ArticleMeta {...props} />\n      </div>\n    </div>\n  );\n}\n\nfunction ArticleMeta({ article }: { article: Article }) {\n  const user = useUser();\n\n  return (\n    <div className='article-meta'>\n      <ArticleAuthorInfo article={article} />\n\n      {user && user.uid === article.author.uid ? (\n        <OwnerArticleMetaActions article={article} />\n      ) : (\n        <NonOwnerArticleMetaActions article={article} />\n      )}\n    </div>\n  );\n}\n\nfunction ArticleAuthorInfo({\n  article: {\n    author: { username, image },\n    createdAt,\n  },\n}: {\n  article: Article;\n}) {\n  return (\n    <Fragment>\n      <Link to={`/profile/${username}`}>\n        <img src={image || undefined} />\n      </Link>\n      <div className='info'>\n        <Link className='author' to={`/profile/${username}`}>\n          {username}\n        </Link>\n        <span className='date'>{format(new Date(createdAt), 'PP')}</span>\n      </div>\n    </Fragment>\n  );\n}\n\nfunction NonOwnerArticleMetaActions({\n  article: {\n    slug,\n    favoritesCount,\n    favorited,\n    author: { username, following, uid },\n  },\n}: {\n  article: Article;\n}) {\n  const [submittingFavorite, setSubmittingFavorite] = useState(false);\n  const [submittingFollow, setSubmittingFollow] = useState(false);\n\n  const user = useUser();\n  const [, emitFavoriteAction] = useArticleFavorites();\n  const [, emitFollowAction] = useFollowers();\n\n  async function onFavorite() {\n    if (!user) {\n      redirect('register');\n      return;\n    }\n\n    setSubmittingFavorite(true);\n\n    await emitFavoriteAction({\n      type: favorited ? 'UnfavoriteAction' : 'FavoriteAction',\n      slug,\n      uid: user.uid,\n    });\n\n    setSubmittingFavorite(false);\n  }\n\n  async function onFollow() {\n    if (!user) {\n      redirect('register');\n      return;\n    }\n\n    setSubmittingFollow(true);\n\n    await emitFollowAction({\n      type: following ? 'UnfollowAction' : 'FollowAction',\n      follower: user.uid,\n      uid: user.uid,\n      leader: uid,\n    });\n\n    setSubmittingFollow(false);\n  }\n\n  return (\n    <Fragment>\n      <button\n        className={classObjectToClassName({\n          btn: true,\n          'btn-sm': true,\n          'btn-outline-secondary': !following,\n          'btn-secondary': following,\n        })}\n        disabled={submittingFollow}\n        onClick={onFollow}\n      >\n        <i className='ion-plus-round'></i>\n        &nbsp; {(following ? 'Unfollow ' : 'Follow ') + username}\n      </button>\n      &nbsp;\n      <button\n        className={classObjectToClassName({\n          btn: true,\n          'btn-sm': true,\n          'btn-outline-primary': !favorited,\n          'btn-primary': favorited,\n        })}\n        disabled={submittingFavorite}\n        onClick={onFavorite}\n      >\n        <i className='ion-heart'></i>\n        &nbsp; {(favorited ? 'Unfavorite ' : 'Favorite ') + 'Article'}\n        <span className='counter'>({favoritesCount})</span>\n      </button>\n    </Fragment>\n  );\n}\n\nfunction OwnerArticleMetaActions({ article: { slug } }: { article: Article }) {\n  const [deleting, setDeleting] = useState(false);\n\n  const user = useUser();\n  const [, emitArticleAction] = useArticlesDB();\n\n  async function onDeleteArticle() {\n    if (!user) {\n      redirect('');\n      return;\n    }\n\n    setDeleting(true);\n\n    await emitArticleAction({\n      type: 'DeleteArticleAction',\n      slug,\n      uid: user.uid,\n    });\n  }\n\n  return (\n    <Fragment>\n      <button className='btn btn-outline-secondary btn-sm' onClick={() => redirect(`editor/${slug}`)}>\n        &nbsp; Edit Article\n      </button>\n      &nbsp;\n      <button className='btn btn-outline-danger btn-sm' disabled={deleting} onClick={onDeleteArticle}>\n        Delete Article\n      </button>\n    </Fragment>\n  );\n}\n\nfunction CommentSection({ article }: { article: Article }) {\n  const user = useUser();\n  const comments = useArticleComments();\n\n  return (\n    <div className='row'>\n      <div className='col-xs-12 col-md-8 offset-md-2'>\n        {user ? (\n          <CommentForm user={user} slug={article.slug} />\n        ) : (\n          <p style={{ display: 'inherit' }}>\n            <Link to='/login'>Sign in</Link> or <Link to='/register'>sign up</Link> to add comments on this article.\n          </p>\n        )}\n        {comments ? (\n          comments\n            .filter(({ slug }) => slug === article.slug)\n            .map((comment, index) => (\n              <ArticleComment key={comment.commentId} comment={comment} slug={article.slug} user={user} index={index} />\n            ))\n        ) : (\n          <div>Loading comments...</div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nfunction CommentForm({ user: { image, uid }, slug }: { user: User; slug: string }) {\n  const [body, setBody] = useState('');\n  const [submittingComment, setSubmitting] = useState(false);\n  const [, emitCommentAction] = useArticleCommentsDB();\n\n  async function onPostComment(ev) {\n    ev.preventDefault();\n\n    setSubmitting(true);\n\n    await emitCommentAction({\n      type: 'CreateComment',\n      uid: uid,\n      body,\n      slug,\n      commentId: Math.random(),\n      createdAt: Date.now(),\n    });\n\n    setBody('');\n    setSubmitting(false);\n  }\n\n  return (\n    <form className='card comment-form' onSubmit={onPostComment}>\n      <div className='card-block'>\n        <textarea\n          className='form-control'\n          placeholder='Write a comment...'\n          rows={3}\n          onChange={(e) => setBody(e.target.value)}\n          value={body}\n        ></textarea>\n      </div>\n      <div className='card-footer'>\n        <img src={image || undefined} className='comment-author-img' />\n        <button className='btn btn-sm btn-primary' disabled={submittingComment}>\n          Post Comment\n        </button>\n      </div>\n    </form>\n  );\n}\n\nfunction ArticleComment({\n  comment: { commentId, body, createdAt, author },\n  slug,\n  index,\n  user,\n}: {\n  comment: Comment;\n  slug: string;\n  index: number;\n  user: User;\n}) {\n  const { username, image } = author || {};\n\n  const [, emitCommentAction] = useArticleCommentsDB();\n\n  return (\n    <div className='card'>\n      <div className='card-block'>\n        <p className='card-text'>{body}</p>\n      </div>\n      <div className='card-footer'>\n        <Link className='comment-author' to={`/profile/${username}`}>\n          <img src={image || undefined} className='comment-author-img' />\n        </Link>\n        &nbsp;\n        <Link className='comment-author' to={`/profile/${username}`}>\n          {username}\n        </Link>\n        <span className='date-posted'>{format(createdAt, 'PP')}</span>\n        {user && user.username === username && (\n          <span className='mod-options'>\n            <i\n              className='ion-trash-a'\n              aria-label={`Delete comment ${index + 1}`}\n              onClick={() =>\n                emitCommentAction({\n                  slug,\n                  commentId,\n                  uid: user.uid,\n                  type: 'DeleteComment',\n                })\n              }\n            ></i>\n          </span>\n        )}\n      </div>\n    </div>\n  );\n}\n","import { Fragment } from 'react';\nimport { HashRouter, Redirect, Route, RouteProps, Switch } from 'react-router-dom';\nimport { EditArticle } from './Pages/EditArticle';\nimport { Footer } from './Footer';\nimport { Header } from './Header';\nimport { Home } from './Pages/Home';\nimport { Login } from './Pages/Login';\nimport { NewArticle } from './Pages/NewArticle';\nimport { Register } from './Pages/Register';\nimport { Settings } from './Pages/Settings';\nimport { ProfilePage } from './Pages/ProfilePage';\nimport { ArticlePage } from './Pages/ArticlePage';\nimport { useUser } from '../services/user';\n\nexport function App() {\n  const userIsLogged = !!useUser();\n\n  return (\n    <HashRouter>\n      <Fragment>\n        <Header />\n        <Switch>\n          <GuestOnlyRoute exact path='/login' userIsLogged={userIsLogged}>\n            <Login />\n          </GuestOnlyRoute>\n          <GuestOnlyRoute exact path='/register' userIsLogged={userIsLogged}>\n            <Register />\n          </GuestOnlyRoute>\n          <UserOnlyRoute exact path='/settings' userIsLogged={userIsLogged}>\n            <Settings />\n          </UserOnlyRoute>\n          <UserOnlyRoute exact path='/editor' userIsLogged={userIsLogged}>\n            <NewArticle />\n          </UserOnlyRoute>\n          <UserOnlyRoute exact path='/editor/:slug' userIsLogged={userIsLogged}>\n            <EditArticle />\n          </UserOnlyRoute>\n          <Route path='/profile/:username'>\n            <ProfilePage />\n          </Route>\n          <Route path='/article/:slug'>\n            <ArticlePage />\n          </Route>\n          <Route exact path='/'>\n            <Home />\n          </Route>\n          <Route path='*'>\n            <Redirect to='/' />\n          </Route>\n        </Switch>\n        <Footer />\n      </Fragment>\n    </HashRouter>\n  );\n}\n\n/* istanbul ignore next */\nfunction GuestOnlyRoute({\n  children,\n  userIsLogged,\n  ...rest\n}: { children: JSX.Element | JSX.Element[]; userIsLogged: boolean } & RouteProps) {\n  return (\n    <Route {...rest}>\n      {children}\n      {userIsLogged && <Redirect to='/' />}\n    </Route>\n  );\n}\n\n/* istanbul ignore next */\nfunction UserOnlyRoute({\n  children,\n  userIsLogged,\n  ...rest\n}: { children: JSX.Element | JSX.Element[]; userIsLogged: boolean } & RouteProps) {\n  return (\n    <Route {...rest}>\n      {children}\n      {!userIsLogged && <Redirect to='/' />}\n    </Route>\n  );\n}\n","import ReactDOM from 'react-dom';\nimport './index.css';\nimport { App } from './components/App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}